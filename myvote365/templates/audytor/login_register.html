
<!DOCTYPE html>
{% load staticfiles %}
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>myVote365 – Login / Register</title>
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="{% static 'css/login-register.css' %}">
    <script src="https://www.google.com/recaptcha/api.js?render=6LekELYUAAAAAD0T6UTe8hN9tTeFNZ9JEDTR25H1"></script>
    <script src="{% static 'javascript/jquery-3.4.1.min.js' %}"></script>
    <script>

        var reChaptcha_token = null;
        grecaptcha.ready(function() {
            generateReChaptchaToken()
        });

        $(function(){
            console.log('jQ is ON!')

            //* register
            $('#register > form').submit(function(){
                console.log('Register start')
                let first_last_name = $('#register_first_last_name').val();
                let email = $('#register_email').val();
                let password_1 = $('#register_password_1').val();
                let password_2 = $('#register_password_2').val();
                let reCaptcha_response = reChaptcha_token;
                console.log(reCaptcha_response);
                let csrfmiddlewaretoken = $('[name=csrfmiddlewaretoken]').val();

                $.post('{% url 'audytor:register' %}', {
                    first_last_name: first_last_name,
                    email: email,
                    password_1: password_1,
                    password_2: password_2,
                    reCaptcha_response: reCaptcha_response,
                    csrfmiddlewaretoken: csrfmiddlewaretoken,
                }).done(function(response_raw){

                    //* write callback
                    response_json = JSON.parse(response_raw)
                    let responses_count = Object.keys(response_json).length
                    for( i = 0; i < responses_count; i++ ){
                        let place = response_json[i].place;
                        let type = response_json[i].type;
                        let msg = response_json[i].msg;
                        $('#'+place).attr('data-callback-type', type).text(msg)
                    }

                }).fail(function(){

                });

                generateReChaptchaToken()
                return false;
            });

        }); // jQ END

        function generateReChaptchaToken(){
            grecaptcha.execute('6LekELYUAAAAAD0T6UTe8hN9tTeFNZ9JEDTR25H1', {action: 'register'}).then(function(token) {
                {#console.log('reCaptcha')#}
                {#console.log(token)#}
                reChaptcha_token = token
            });
        }

    </script>
</head>
<body>

    <main>

        {% csrf_token %}

        <article id="login">
            <form>
                <header>Zaloguj się</header>
                <section>
                    <label for="login_email">Twój Email</label>
                    <input id="login_email" name="login_email" type="email" placeholder="twój@email.com" required autofocus>
                </section>
                <section>
                    <label for="login_password">Twoje hasło</label>
                    <input id="login_password" name="login_password" type="password" placeholder="********" required>
                </section>
                <section>
                    <input type="submit" value="Zaloguj się">
                    <p class="callback" data-callback-type="" id="callback-login-submit"></p>
                </section>
            </form>
        </article>

        <article id="register">
            <form>
                <header>Zarejestruj się</header>
                <section>
                    <label for="register_first_last_name">Wpisz imię i nazwisko</label>
                    <input id="register_first_last_name" name="register_first_last_name" type="text" placeholder="Jan nowak" required value="Jan Nowak">
                </section>
                <section>
                    <label for="register_email">Twój email</label>
                    <input id="register_email" name="register_email" type="email" placeholder="twój@email.com" required value="kukizk+jannowak@gmail.com">
                    <p class="callback" data-callback-type="" id="callback-register-email"></p>
                </section>
                <section>
                    <label for="register_password_1">Hasło</label>
                    <input id="register_password_1" name="register_password_1" type="password" placeholder="Wpisz hasło" required value="zaq1@WSX">
                    <p class="callback" data-callback-type="" id="callback-register-password-1"></p>
                    <ul>
                        <li>Minimum 8 znaków</li>
                        <li>Co Najmniej 1 liczba</li>
                        <li>Co Najmniej 1 znak specjalny (!, @, #, $, …)</li>
                        <li>Co Najmniej 1 wielka litera (A, B, C, …)</li>
                        <li>Co Najmniej 1 mała litera (a, b, c, …)</li>
                    </ul>
                    <ul>
                        <li>Hasła są identyczne</li>
                    </ul>
                    <input id="register_password_2" name="register_password_2" type="password" placeholder="Potwierdź hasło" required value="zaq1@WSX">
                    <p class="callback" data-callback-type="" id="callback-register-password-2"></p>
                </section>
                <section>
                    <input type="submit" value="Zarejestruj się">
                    <p class="callback" id="callback-register-submit"></p>
                </section>
            </form>
        </article>

    </main>

    <footer>
        Autor: <span>Krzysztof Kukiz</span> (<a href="mailto:kukizk@gmail.com">kukizk@gmail.com</a>) &copy; 2019
    </footer>

</body>
</html>